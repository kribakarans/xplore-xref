<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{ PAGE_TITLE }}</title>
  <link rel="icon" href="__xplore/favicon.ico" type="image/png">

  <!-- Aggregated stylesheet -->
  <link rel="stylesheet" href="__xplore/styles.css" />

  <!-- Codicons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@vscode/codicons/dist/codicon.css">

  <!-- Monaco loader -->
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.min.js"></script>

  <!-- Markdown preview (with highlight.js) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/github-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/12.3.2/markdown-it.min.js"></script>
</head>

<body class="vscode-theme-dark">
  <!-- GRID SHELL: left | main | right ; statusbar spans -->
  <div id="app" role="application" aria-label="Editor Shell">
    <!-- Left panel (Explorer) -->
    <div id="sidebar" aria-label="Sidebar Left">
      <div id="sidebar-header">
        <h3 onclick="window.open('{{ REPO_URL }}', '_blank')" class="{{ 'clickable' if REPO_URL != '#' else '' }}">
          {{ APP_NAME }}
        </h3>
        <span id="search-toggle" class="codicon codicon-search" title="Toggle file search"></span>
      </div>
      <input type="text" id="file-search" placeholder="Search files..." style="display:none;" />
      <ul id="file-tree" class="tree" role="tree" aria-label="File explorer"></ul>
    </div>

    <!-- Main area (Editor + Preview only) -->
    <div id="main" aria-label="Editor">
      <div id="editor-toolbar">
        <div id="tabs"></div>
        <div id="editor-tools">
          <span id="nav-back" class="codicon codicon-arrow-left" title="Navigate Back (Alt+←)"></span>
          <span id="nav-forward" class="codicon codicon-arrow-right" title="Navigate Forward (Alt+→)"></span>
          <span id="editor-preview" class="codicon codicon-eye" title="Toggle Preview (MD/HTML)"></span>

          <!-- Symbols: keep only File Symbols (Workspace handled via modal toggle) -->
          <span id="file-symbols" class="codicon codicon-list-selection" title="File Symbols (Ctrl+Shift+O)"></span>
          <span id="workspace-grep" class="codicon codicon-search-sparkle" title="Grep in Workspace (Ctrl+Shift+F)"></span>
          <span id="editor-wrap" class="codicon codicon-word-wrap" title="Toggle Word Wrap"></span>
          <span id="editor-minimap" class="codicon codicon-map" title="Toggle Minimap"></span>
          <span id="editor-search" class="codicon codicon-search" title="Find in File"></span>
          <!-- Outline toggle -->
          <span id="toggle-outline" class="codicon codicon-layout-sidebar-right" title="Hide Outline panel" aria-pressed="true"></span>
        </div>
      </div>

      <!-- Breadcrumbs -->
      <div id="breadcrumbs" aria-label="Breadcrumbs"></div>

      <!-- Editor/Preview content -->
      <div id="content">
        <div id="editor"></div>
        <div id="preview">
          <iframe id="preview-frame"
                  sandbox="allow-same-origin allow-scripts allow-forms allow-popups">
          </iframe>
        </div>
      </div>
    </div>

    <!-- Right panel (Outline only) -->
    <div id="right" aria-label="Sidebar Right">
      <aside id="outline">
        <div id="outline-header">
          <span class="title">Outline</span>
          <input id="outline-filter" type="text" placeholder="Filter symbols…" />
        </div>
        <ul id="outline-list"></ul>
      </aside>
    </div>

    <!-- Status bar (spans all columns) -->
    <div id="statusbar" role="status" aria-live="polite">
      <div id="status-left"><span class="codicon codicon-file"></span> —</div>
      <div id="status-center">Ready.</div>
      <div id="status-right">Ln 1, Col 1 • WRAP: OFF • MINIMAP: ON</div>
    </div>

    <!-- Invisible gutters (desktop) -->
    <div class="gutter gutter-left" role="separator" aria-orientation="vertical"
         aria-label="Resize left panel" tabindex="0" title="Drag to resize • Double-click to reset"></div>
    <div class="gutter gutter-right" role="separator" aria-orientation="vertical"
         aria-label="Resize right panel" tabindex="0" title="Drag to resize • Double-click to reset"></div>
  </div>

  <!-- Modals (kept at end so DOM is ready when JS registers) -->
  <!-- Symbol Modal -->
  <div id="symbol-modal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-tabs">
        <button data-tab="workspace" class="active">Workspace</button>
        <button data-tab="file">File</button>
        <button id="symbol-close" class="modal-close" title="Close">×</button>
      </div>

      <!-- Progress bar -->
      <div class="modal-progress" id="symbol-progress"><div class="bar"></div></div>

      <input type="text" id="symbol-query" placeholder="Search symbols…">
      <ul id="symbol-results"></ul>
    </div>
  </div>

  <!-- References Modal -->
  <div id="refs-modal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <span id="refs-title">References</span>
        <button id="refs-close" class="modal-close" title="Close">×</button>
      </div>

      <!-- Progress bar -->
      <div class="modal-progress" id="refs-progress"><div class="bar"></div></div>

      <ul id="refs-results"></ul>
    </div>
  </div>

  <!-- Grep Modal -->
  <div id="grep-modal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <span id="grep-title">Grep in Workspace</span>
        <button id="grep-close" class="modal-close" title="Close">×</button>
      </div>

      <input type="text" id="grep-query" placeholder="Enter search string…">

      <!-- Progress bar -->
      <div class="modal-progress" id="grep-progress"><div class="bar"></div></div>

      <ul id="grep-results"></ul>
    </div>
  </div>

  <div id="toast" role="status" aria-live="polite"></div>

  <!-- Scripts -->
  <script type="module" src="__xplore/js/ui-layout.js"></script>
  <script type="module" src="__xplore/js/app.js"></script>
</body>
</html>
